From c42bc52f59279594194ace8b021f7630d6dd7298 Mon Sep 17 00:00:00 2001
From: Tilmann Meyer <me@atiltedtree.dev>
Date: Fri, 19 Nov 2021 15:06:58 +0100
Subject: [PATCH 18/19] make sure xul links with mozgtk

---
 widget/gtk/mozgtk/mozgtk.c | 2 ++
 widget/gtk/nsWindow.cpp    | 4 ++++
 2 files changed, 6 insertions(+)

diff --git a/widget/gtk/mozgtk/mozgtk.c b/widget/gtk/mozgtk/mozgtk.c
index d7dbbc6fd9e3a..75c6f71832f97 100644
--- a/widget/gtk/mozgtk/mozgtk.c
+++ b/widget/gtk/mozgtk/mozgtk.c
@@ -6,6 +6,8 @@
 
 #include "mozilla/Types.h"
 
+MOZ_EXPORT void PleaseLinkWithMe() {}
+
 #ifdef MOZ_X11
 #  include <X11/Xlib.h>
 // Bug 1271100
diff --git a/widget/gtk/nsWindow.cpp b/widget/gtk/nsWindow.cpp
index e6aa6215c4d58..2cfdc98dc4fc6 100644
--- a/widget/gtk/nsWindow.cpp
+++ b/widget/gtk/nsWindow.cpp
@@ -120,6 +120,9 @@ using namespace mozilla::gfx;
 using namespace mozilla::layers;
 using namespace mozilla::widget;
 
+// Make sure mozgtk gets linked
+void PleaseLinkWithMe();
+
 // Don't put more than this many rects in the dirty region, just fluff
 // out to the bounding-box if there are more
 #define MAX_RECTS_IN_REGION 100
@@ -499,6 +502,7 @@ nsWindow::nsWindow()
       mRelativePointer(nullptr)
 #endif
 {
+  PleaseLinkWithMe();
   mWindowType = eWindowType_child;
   mSizeConstraints.mMaxSize = GetSafeWindowSize(mSizeConstraints.mMaxSize);
 
-- 
2.34.0

