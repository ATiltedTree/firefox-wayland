From 57eed4533eed120c65e7e601dbe11f2564c00a08 Mon Sep 17 00:00:00 2001
From: Tilmann Meyer <me@atiltedtree.dev>
Date: Fri, 19 Nov 2021 12:31:16 +0100
Subject: [PATCH 16/22] If only wayland is enabled, always use it regardless of
 MOZ_ENABLE_WAYLAND

---
 toolkit/xre/nsAppRunner.cpp | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/toolkit/xre/nsAppRunner.cpp b/toolkit/xre/nsAppRunner.cpp
index 60ea6966cccf2..f3a472b127a8b 100644
--- a/toolkit/xre/nsAppRunner.cpp
+++ b/toolkit/xre/nsAppRunner.cpp
@@ -4113,6 +4113,7 @@ static void PR_CALLBACK ReadAheadDlls_ThreadStart(void* arg) {
 
 #if defined(MOZ_WAYLAND)
 bool IsWaylandEnabled() {
+#  ifdef MOZ_X11
   const char* waylandDisplay = PR_GetEnv("WAYLAND_DISPLAY");
   if (!waylandDisplay) {
     return false;
@@ -4135,6 +4136,9 @@ bool IsWaylandEnabled() {
     NS_WARNING("Running Wayland backen on Gtk3 < 3.22. Expect issues/glitches");
   }
   return enableWayland;
+#  else
+  return true;
+#  endif
 }
 #endif
 
-- 
2.34.1

