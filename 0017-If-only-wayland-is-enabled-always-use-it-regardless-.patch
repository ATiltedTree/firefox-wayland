From 5b0d4c31d5e0f9a661c04af23a0dfa0dd192f559 Mon Sep 17 00:00:00 2001
From: Tilmann Meyer <me@atiltedtree.dev>
Date: Fri, 19 Nov 2021 12:31:16 +0100
Subject: [PATCH 17/22] If only wayland is enabled, always use it regardless of
 MOZ_ENABLE_WAYLAND

---
 toolkit/xre/nsAppRunner.cpp | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/toolkit/xre/nsAppRunner.cpp b/toolkit/xre/nsAppRunner.cpp
index d3bb8096ad02e..bff735caa9d83 100644
--- a/toolkit/xre/nsAppRunner.cpp
+++ b/toolkit/xre/nsAppRunner.cpp
@@ -4076,6 +4076,7 @@ static void PR_CALLBACK ReadAheadDlls_ThreadStart(void* arg) {
 
 #if defined(MOZ_WAYLAND)
 bool IsWaylandEnabled() {
+#  ifdef MOZ_X11
   const char* waylandDisplay = PR_GetEnv("WAYLAND_DISPLAY");
   if (!waylandDisplay) {
     return false;
@@ -4098,6 +4099,9 @@ bool IsWaylandEnabled() {
     NS_WARNING("Running Wayland backen on Gtk3 < 3.22. Expect issues/glitches");
   }
   return enableWayland;
+#  else
+  return true;
+#  endif
 }
 #endif
 
-- 
2.35.1

